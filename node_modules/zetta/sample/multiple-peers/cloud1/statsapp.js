var influx = require('influx');

var client = influx({
  // or single-host configuration
  host : 'sandbox.influxdb.com',
  port : 8086, // optional, default 8086
  username : 'admin',
  password : 'admin',
  database : 'zetta-test'
});


module.exports = function(server) {
  var events = ['_peer/connect', '_peer/disconnect'];
  events.forEach(function(event) {
    server.pubsub.subscribe(event, function(event, info) {
      var topic = event.replace('_peer/','');
      var data = { time : new Date(), peer: info.peer.name };
      data[topic] = 1;
      client.writePoint('peer_connection_stats', data , function(err) { });
    });
  });
};
